# 四星手语平台阿里云部署方案

## 一、项目技术栈分析

### 当前项目技术栈
- **前端：** React + TypeScript + Vite
- **后端：** Express + Node.js
- **数据库：** Supabase
- **API通信：** RESTful API

### 与SpringBoot+Vue的区别
- **后端框架不同：** Express (Node.js) vs SpringBoot (Java)
- **前端框架不同：** React vs Vue
- **构建工具不同：** Vite vs 可能是Webpack
- **运行环境不同：** Node.js vs JVM

## 二、部署环境准备

### 1. 阿里云服务器配置
- **推荐配置：** 2核4GB内存，40GB SSD，5Mbps带宽
- **操作系统：** CentOS 7.6（与教程一致）
- **安全组：** 开放80、443、22端口

### 2. 宝塔面板安装
- 执行宝塔面板安装命令：`yum install -y wget && wget -O install.sh http://download.bt.cn/install/install_6.0.sh && sh install.sh`
- 记录面板登录地址、用户名和密码

### 3. 环境安装（通过宝塔面板）
- **Node.js：** 安装v18+版本
- **Nginx：** 宝塔面板默认安装
- **PM2：** 通过npm全局安装

## 三、部署步骤

### 1. 前端部署

#### 步骤1：本地构建
- 在本地执行：`npm run build`
- 生成的`dist`文件夹包含构建后的静态文件

#### 步骤2：上传文件
- 通过宝塔面板的文件管理上传`dist`文件夹到服务器
- 建议路径：`/www/wwwroot/star-sign-language`

#### 步骤3：Nginx配置
- 在宝塔面板创建网站
- 域名设置：填写你的域名（如无域名，可使用服务器IP）
- 网站目录：指向`/www/wwwroot/star-sign-language/dist`
- 启用HTTPS（推荐）

### 2. 后端部署

#### 步骤1：上传代码
- 通过宝塔面板上传后端代码到服务器
- 建议路径：`/www/wwwroot/star-sign-language-backend`

#### 步骤2：安装依赖
- 在服务器后端目录执行：`npm install`

#### 步骤3：配置环境变量
- 编辑`.env`文件，配置Supabase信息：
  ```
  SUPABASE_URL=https://your-supabase-project.supabase.co
  SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
  JWT_SECRET=your-jwt-secret
  PORT=3001
  NODE_ENV=production
  ```

#### 步骤4：启动服务
- 使用PM2启动后端服务：`pm2 start server.js --name star-sign-language-backend`
- 配置PM2自动重启：`pm2 save && pm2 startup`

### 3. API代理配置

#### 步骤1：Nginx反向代理
- 在前端网站的Nginx配置中添加反向代理：
  ```nginx
  location /api {
      proxy_pass http://localhost:3001/api;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
  }
  ```

#### 步骤2：前端API配置
- 确保前端`api.ts`中使用相对路径：
  ```typescript
  const API_BASE_URL = import.meta.env.PROD ? '/api' : 'http://localhost:3001/api';
  ```

### 4. Supabase配置

#### 步骤1：创建数据库表
- 在Supabase控制台创建必要的表：
  - `users`表：存储用户信息
  - `lessons`表：存储课程信息
  - `progress`表：存储学习进度

#### 步骤2：配置Row Level Security
- 为表配置适当的访问权限
- 确保用户只能访问自己的数据

#### 步骤3：国内访问优化
- 配置API超时和重试机制
- 考虑使用云函数或边缘函数加速访问

### 5. 多媒体内容配置

#### 步骤1：存储方案选择
- **方案A：** 使用Supabase Storage
- **方案B：** 使用阿里云OSS（推荐，国内访问更快）

#### 步骤2：阿里云OSS配置
- 创建OSS存储空间
- 配置访问权限
- 集成到前端和后端代码

#### 步骤3：CDN加速
- 配置阿里云CDN加速静态资源
- 提高国内访问速度

## 三、安全配置

### 1. 服务器安全
- 配置宝塔面板防火墙
- 定期更新系统和软件
- 禁用不必要的端口

### 2. 应用安全
- 使用HTTPS
- 密码加密存储
- API接口认证
- 防止SQL注入

### 3. Supabase安全
- 保护API密钥
- 配置适当的Row Level Security
- 定期轮换密钥

## 四、性能优化

### 1. 前端优化
- 静态资源压缩
- 图片懒加载
- 代码分割
- 缓存策略

### 2. 后端优化
- API响应缓存
- 数据库查询优化
- 连接池管理

### 3. 多媒体优化
- 视频转码和压缩
- CDN加速
- 按需加载

### 4. Supabase访问优化
- 使用批量API调用
- 减少不必要的数据库请求
- 配置合理的缓存策略

## 五、监控与维护

### 1. 监控方案
- 宝塔面板监控
- PM2进程监控
- Nginx访问日志

### 2. 维护计划
- 定期备份数据库
- 检查系统更新
- 优化数据库性能
- 监控访问量和响应时间

## 六、部署成本估算

### 1. 服务器成本
- 阿里云ECS：约300-500元/月（2核4GB配置）
- 带宽费用：按实际使用计费

### 2. 域名费用
- 域名注册：约50-100元/年
- SSL证书：免费（Let's Encrypt）或付费

### 3. 存储成本
- 阿里云OSS：按实际使用计费
- 或使用服务器本地存储：包含在服务器费用中

### 4. Supabase成本
- 免费计划：适合小型项目（有使用限制）
- 付费计划：根据使用量计费

## 七、常见问题解决

### 1. 国内访问速度慢
- **解决方案：** 使用阿里云OSS存储多媒体内容，配置CDN加速

### 2. Supabase连接不稳定
- **解决方案：** 配置API代理，增加超时和重试机制

### 3. 前端构建失败
- **解决方案：** 确保Node.js版本正确，依赖安装完整

### 4. 后端服务无法启动
- **解决方案：** 检查端口占用，查看错误日志，确保环境变量配置正确

### 5. 数据库连接失败
- **解决方案：** 检查Supabase API密钥和URL配置，确保网络连接正常

## 八、部署验证

### 1. 功能验证
- 访问网站首页
- 测试用户注册和登录
- 测试课程浏览
- 测试学习进度保存

### 2. 性能验证
- 测量页面加载速度
- 测试API响应时间
- 验证多媒体内容加载速度

### 3. 安全验证
- 检查HTTPS配置
- 测试用户权限控制
- 验证数据传输加密

此方案确保平台在国内稳定运行，用户不需要翻墙就能访问网站，同时支持用户注册登录和多媒体内容的后续扩展。